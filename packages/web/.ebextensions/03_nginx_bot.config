files:
    "/etc/nginx/conf.d/globalblacklist.conf":
        source: https://raw.githubusercontent.com/mitchellkrogza/nginx-ultimate-bad-bot-blocker/master/conf.d/globalblacklist.conf
        mode: "000644"
        owner: root
        group: root
    "/etc/nginx/conf.d/botblocker-nginx-settings.conf":
        source: https://raw.githubusercontent.com/mitchellkrogza/nginx-ultimate-bad-bot-blocker/master/conf.d/botblocker-nginx-settings.conf
        mode: "000644"
        owner: root
        group: root
    "/tmp/fix_nginx_bot_blocker.sh":
        mode: "000755"
        owner: root
        group: root
        content: |
            #!/bin/bash
            pushd $(/opt/elasticbeanstalk/bin/get-config container -k config_staging_dir)
            echo "Add Bad Blocker"
            PROXY_CONF="#etc#nginx#conf.d#00_elastic_beanstalk_proxy.conf"
            grep "bots.d" $PROXY_CONF || sed -i '/location \/react-assets {/i\ \ \ \ include bots.d/blockbots.conf;\n\ \ \ \ include bots.d/ddos.conf;\n' $PROXY_CONF
            BOTS_O="/tmp/deployment/application/packages/web/.ebextensions/nginx/bots.d"
            BOTS_D="/etc/nginx/"
            cp -r $BOTS_O $BOTS_D
container_commands:
    01_include_blocker:
        command : "/tmp/fix_nginx_bot_blocker.sh"
